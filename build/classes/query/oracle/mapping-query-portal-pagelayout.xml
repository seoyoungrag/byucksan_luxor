<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.2.dtd">

<queryservice>
	<queries>
		<query id="insertPageLayout">
			<statement>
			<![CDATA[
				insert into tlxr_page_layout (
                        tenant_id, 
                        portal_id,                
                        layout_id, 
                        layout_name_id, 
                        layout_css, 
                        reg_date, 
                        reg_user_id, 
                        is_default 
                    ) 
                    values (
                        :vo.tenantId,
                        :vo.portalId,
                        :vo.layoutId,
                        :vo.layoutNameId,
                        :vo.layoutCss,
                        :vo.regDate,
                        :vo.regUserId,
                        :vo.isDefault
                    ) 
			]]>
			</statement>
		</query>

        <query id="updatePageLayout">
            <statement>
            <![CDATA[
                update tlxr_page_layout set
                    #if ($vo.layoutCss && !$vo.layoutCss.equals("")) 
                       layout_css=:vo.layoutCss, 
                    #end
                    #if ($vo.isDefault && !$vo.isDefault.equals(""))
                       is_default=:vo.isDefault,
                    #end
                    mod_date=:vo.modDate,
                    mod_user_id=:vo.modUserId 
                 where tenant_id=:vo.tenantId
                   and portal_id=:vo.portalId
                   and layout_id=:vo.layoutId 
            ]]>
            </statement>
        </query>

        <query id="resetDefaultPageLayout">
            <statement>
            <![CDATA[
                update tlxr_page_layout set is_default='N'
                 where tenant_id=:vo.tenantId
                   and portal_id=:vo.portalId
                   and is_default='Y'
            ]]>
            </statement>
        </query>

        <query id="deletePageLayout">
            <statement>
            <![CDATA[
                delete from tlxr_page_layout 
                 where tenant_id=:vo.tenantId
                   and portal_id=:vo.portalId
                   and layout_id=:vo.layoutId 
            ]]>
            </statement>
        </query>

        <query id="getPageLayout">
            <statement>
            <![CDATA[
                select * from tlxr_page_layout 
                 where tenant_id=:vo.tenantId
                   and portal_id in (select portal_id from tlxr_portal_group where child_portal like '%' || :vo.portalId || '%'  ESCAPE '_'  or portal_id = :vo.portalId)
                 #if ($vo.layoutId && !$vo.layoutId.equals(""))
                   and layout_id=:vo.layoutId
                 #else
                   and is_default='Y'
                 #end 
            ]]>
            </statement>
            <result class="com.sds.acube.luxor.portal.vo.PortalPageLayoutVO"/>
        </query>

        <query id="getPageLayoutList">
            <statement>
            <![CDATA[
                select a.*, b.message_name, b.lang_type from tlxr_page_layout a, tlxr_message b
                 where a.tenant_id=b.tenant_id
                   and a.portal_id=b.portal_id
                   and a.layout_name_id=b.message_id
                   and a.tenant_id=:vo.tenantId
                   and a.portal_id=:vo.portalId 
                   and b.lang_type=:vo.langType
                 order by a.reg_date desc, layout_id desc
            ]]>
            </statement>
            <result class="com.sds.acube.luxor.portal.vo.PortalPageLayoutVO"/>
        </query>

	</queries>
</queryservice>
